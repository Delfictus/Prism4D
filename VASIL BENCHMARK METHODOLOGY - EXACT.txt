VASIL BENCHMARK METHODOLOGY - EXACT SPECIFICATION

  Based on Nature publication Extended Data Fig. 6a (page 20) and Methods section.

  ---
  1. PREDICTION TASK DEFINITION

  What VASIL Predicts:

  Per-Day Direction Classification (NOT per-structure classification)

  For each:
  - Variant y (lineage/spike pseudo-group)
  - Country (12 total: Germany, USA, UK, Japan, Brazil, France, Canada, Denmark, Australia, Sweden, Mexico, South Africa)
  - Day t (every calendar day in evaluation window)

  Predict: Will variant y RISE (1) or FALL (-1) in frequency tomorrow?

  ---
  2. ACCURACY CALCULATION (Extended Data Fig. 6a)

  Exact Quote from Paper (Page 20):

  "Accuracy is determined by partitioning the frequency curve πy into days of rising (1) and falling (−1) trends, then comparing these with corresponding predictions γy: If the full envelope is positive, the prediction is rising (1); if the full envelope is negative, the prediction is falling (−1). Days with negligible frequency changes or undecided predictions (envelopes with both positive and negative values) are excluded from the analysis."

  Step-by-Step Algorithm:

  # For each (country, lineage, day) triplet:

  # Step 1: Compute actual direction from frequency data
  actual_direction = sign(π_y(t) - π_y(t-1))

  # Step 2: Compute predicted direction from γy(t)
  # γy has uncertainty envelope from PK variability (tmax, thalf grid)
  γy_min = min(γy(t) across all 75 PK parameter combinations)
  γy_max = max(γy(t) across all 75 PK parameter combinations)

  if γy_min > 0 and γy_max > 0:
      predicted_direction = +1  # RISE
  elif γy_min < 0 and γy_max < 0:
      predicted_direction = -1  # FALL
  else:
      predicted_direction = None  # UNDECIDED (envelope crosses 0)

  # Step 3: Filter exclusions
  freq_change_magnitude = abs(π_y(t) - π_y(t-1))
  relative_change = freq_change_magnitude / π_y(t-1)

  # EXCLUDE if:
  if relative_change < 0.05:  # < 5% relative change (negligible)
      EXCLUDE
  elif predicted_direction is None:  # Envelope crosses zero
      EXCLUDE
  elif π_y(t) < 0.03:  # Lineage below 3% frequency (noise filter)
      EXCLUDE
  else:
      # INCLUDE in accuracy calculation
      correct = (actual_direction == predicted_direction)

  # Step 4: Per-lineage-country accuracy
  accuracy_per_lineage_country = sum(correct) / sum(included_days)

  # Step 5: MEAN across all (lineage, country) pairs
  overall_accuracy = mean(accuracy_per_lineage_country for all pairs)

  Critical Details:

  Inclusion Criteria:
  - ✅ Lineage reached ≥ 3% peak frequency at some point (Fig. 4 caption)
  - ✅ Day has ≥ 5% relative frequency change (page 8: "Exclude negligible changes")
  - ✅ Prediction envelope does NOT cross zero (γy_min and γy_max have same sign)

  Exclusion Criteria:
  - ❌ Lineage never reached 3% frequency → exclude entire lineage
  - ❌ Day has < 5% relative frequency change → exclude that day
  - ❌ Prediction uncertain (envelope crosses 0) → exclude that day

  ---
  3. EVALUATION WINDOW

  Germany (Primary Analysis):

  Training Period: July 1, 2021 - March 1, 2022 (8 months "burn-in")
  Evaluation Period: March 1, 2022 - July 1, 2024 (28 months)

  International (11 Countries):

  Evaluation Period: October 2022 - October 2023 (12 months)
  Per Extended Data Fig. 6a, the 20 most common lineages during this window.

  Forward Prediction Example (Fig. 3b):

  Training Data Ends: April 16, 2023
  Prediction Horizon: April 16, 2023 - July 27, 2023 (3.5 months)
  Variants Predicted: XBB.1.5, XBB.1.9, XBB.1.16, EG.5.1, BA.2.86

  ---
  4. γy(t) COMPUTATION (Relative Fitness)

  Exact Formula from Methods (Page 12):

  γy(t) = (αy·E[Sy(t)] - Σx∈X πx(t)·αx·E[Sx(t)]) / (Σx∈X πx(t)·αx·E[Sx(t)])

  Where:
  - E[Sy(t)] = Expected number of susceptible individuals to variant y at time t
  - αx ≈ α = Intrinsic transmission fitness (assumed EQUAL for all variants)
  - πx(t) = Frequency of variant x at time t
  - X = Set of all circulating variants with πx(t) ≥ 1%

  Simplification (since αx ≈ α for all x):
  γy(t) = E[Sy(t)] / mean(E[Sx(t)] for x ∈ X weighted by πx(t)) - 1

  E[Sy(t)] Calculation:

  E[Sy(t)] = Pop - E[Immuney(t)]

  E[Immuney(t)] = Σx∈X ∫0^t πx(s)·I(s)·PNeut(t-s, x, y)ds

  Where:
  - Pop = Population size (e.g., 83M for Germany)
  - I(s) = Number of infections at time s (from GInPipe or wastewater)
  - πx(s) = Frequency of variant x at time s
  - PNeut(t-s, x, y) = Probability that infection with x at time s still neutralizes y at time t

  PNeut(t, x, y) Calculation:

  PNeut(t, x, y) = 1 - Πϑ∈A (1 - bϑ(t, x, y))

  Where A = 10 epitope classes (A, B, C, D1, D2, E12, E3, F1, F2, F3) + NTD

  bϑ(t, x, y) = cϑ(t) / (FRx,y(ϑ)·IC50(x)(ϑ) + cϑ(t))

  Where:
  - cϑ(t) = Antibody concentration at time t (from PK model)
  - FRx,y(ϑ) = Fold resistance (from DMS data)
  - IC50(x)(ϑ) = Half-maximal inhibitory concentration

  Antibody Pharmacokinetics cϑ(t):

  cϑ(t) = (e^(-ke·t) - e^(-ka·t)) / (e^(-ke·tmax) - e^(-ka·tmax))

  ke = ln(2) / thalf
  ka = ln((ke·tmax) / (ke·tmax - ln(2)))

  Parameter Grid (75 combinations):
  - tmax ∈ [14, 17, 21, 25, 28] days (5 values)
  - thalf ∈ [25, 29, 34, 38, 43, 47, 52, 56, 60, 63, 65, 67, 69] days (15 values)
  (Uniform grid 25-69 days)

  For each (country, lineage, day):
  - Compute γy(t) for ALL 75 PK combinations
  - Envelope: [min(γy), max(γy)] across 75 combinations

  ---
  5. DATA PREPROCESSING

  Lineage Frequency Smoothing:

  From Methods (Page 11):
  "Daily lineage frequencies were computed by using linear interpolation between time steps."

  Bin sizes: At least 100 sequences per time step

  Spike Pseudo-Groups:

  Clustering: Lineages with identical RBD + NTD alteration profiles → same pseudo-group

  Filter: Only pseudo-groups that reached > 1% frequency at least once

  Definition of "characteristic" mutation (Page 11):
  "An amino acid change was present in at least 75% of all sequences from that lineage."

  Incidence Reconstruction (GInPipe):

  Smoothing: Kernel smoothing with bandwidth = 14 days

  Bin configuration:
  - Time spans: Δdb ∈ {7, 10, 14} days
  - Bin sizes: nb ∈ {2%, 5%, avg_weekly_sequences}
  - Min sequences per bin: 50
  - Max bin span: 21 days

  ---
  6. VASIL's 92% ACCURACY BREAKDOWN

  From Extended Data Fig. 6a:

  Per-Country Accuracies (approximate from figure):
  - Australia: ~0.88-0.95
  - Brazil: ~0.85-0.95
  - Canada: ~0.85-0.95
  - Denmark: ~0.90-0.98
  - France: ~0.88-0.95
  - Japan: ~0.85-0.95
  - Mexico: ~0.85-0.95
  - South Africa: ~0.85-0.95
  - Sweden: ~0.88-0.95
  - UK: ~0.88-0.95
  - USA: ~0.88-0.95

  Average: 0.92 (stated in text)

  Per-Lineage Performance (major lineages shown):
  - BA.5: ~0.92-0.98 across countries
  - XBB.1.16: ~0.88-0.95
  - BQ.1: ~0.85-0.95
  - XBB.1.5: ~0.90-0.98
  - EG.5.1: ~0.88-0.95
  - EG.1: ~0.88-0.92
  - BF.7: ~0.85-0.92

  ---